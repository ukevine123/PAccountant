@page "/accounts/create"
@rendermode InteractiveServer

@using Application.DTOs
@using Application.Interfaces
@inject IAccountService AccountService
@inject NavigationManager Navigation
@using System.ComponentModel.DataAnnotations
@using Application.Services.AccountService

<PageTitle>Create Account</PageTitle>

<MudContainer MaxWidth="MaxWidth.Small" Class="py-8">
    <MudPaper Elevation="1" Class="pa-6">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <MudText Typo="Typo.h5">Create Account</MudText>
            <MudButton Href="/accounts" Variant="Variant.Outlined" Size="Size.Small">Back to list</MudButton>
        </div>

        @* Note: OnValidSubmit must match the method name in @code exactly *@
        <EditForm Model="Model" OnValidSubmit="HandleValidSubmit">
            <DataAnnotationsValidator />
            <MudGrid>
                <MudItem xs="12">
                    <MudTextField @bind-Value="Model.Name" 
                                  Label="Name" 
                                  Placeholder="Enter account name" 
                                  Variant="Variant.Outlined" 
                                  FullWidth="true" 
                                  For="@(() => Model.Name)" />
                </MudItem>
                <MudItem xs="12">
                    <MudNumericField @bind-Value="Model.Balance" 
                                     Label="Initial Balance" 
                                     Placeholder="Enter balance"
                                     Variant="Variant.Outlined" 
                                     FullWidth="true" 
                                     For="@(() => Model.Balance)" />
                </MudItem>
                <MudItem xs="12">
                    <MudButton ButtonType="ButtonType.Submit" 
                               Variant="Variant.Filled" 
                               Color="Color.Primary" 
                               FullWidth="true">
                        Create Account
                    </MudButton>
                </MudItem>
            </MudGrid>
        </EditForm>
    </MudPaper>
</MudContainer>

@code {
    private AccountCreateDTOs Model { get; set; } = new();

    // Renamed to HandleValidSubmit to be explicit and avoid conflicts
    private async Task HandleValidSubmit()
    {
        // Debugging: If the button still "does nothing," 
        // it means the DataAnnotationsValidator found an error in your Model.
        
        var req = new CreateAccountRequest
        {
            Name = Model.Name,
            InitialBalance = Model.Balance
        };

        await AccountService.CreateAccountAsync(req);
        Navigation.NavigateTo("/accounts");
    }
}